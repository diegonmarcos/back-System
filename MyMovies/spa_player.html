<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Movie SPA - OMDb Edition</title>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lodash/lodash.min.js"></script>
    
    <!-- Styles -->
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #e50914; /* Netflix-like red */
            --accent-hover: #f40612;
            --input-bg: #333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header & Controls */
        header {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; color: var(--accent-color); }

        .api-key-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="password"], input[type="text"] {
            background: var(--input-bg);
            border: 1px solid #444;
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            outline: none;
        }

        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }

        button:hover { background-color: var(--accent-hover); }
        button:disabled { background-color: #555; cursor: not-allowed; }
        button.secondary { background-color: #444; }
        button.secondary.active { background-color: var(--text-primary); color: black; }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-box {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: var(--border-radius);
            color: white;
        }

        /* Grid Layout */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
        }

        /* Card Component */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .poster {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            background-color: #000;
        }

        .card-content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 1.1em;
            margin: 0 0 5px 0;
            font-weight: 600;
        }

        .card-meta {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .type-badge {
            text-transform: uppercase;
            font-size: 0.7em;
            padding: 2px 6px;
            background: #333;
            border-radius: 4px;
        }

        .watch-btn {
            margin-top: auto;
            width: 100%;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        /* Loading & Error States */
        .status-msg {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: var(--text-secondary);
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Modal/Player */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #000;
            width: 90%;
            max-width: 1000px;
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 0 30px rgba(229, 9, 20, 0.3);
        }

        .close-btn {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="top-bar">
            <h1>üé¨ Vidsrc Vue (OMDb)</h1>
            <div class="api-key-container">
                <input v-if="!hasApiKey" v-model="tempApiKey" type="text" placeholder="Enter OMDb API Key">
                <button v-if="!hasApiKey" @click="saveApiKey">Save Key</button>
                <button v-else @click="clearApiKey" class="secondary">Change Key</button>
            </div>
        </div>

        <div class="controls">
            <div style="display: flex; gap: 10px;">
                <button :class="['secondary', { active: view === 'home' }]" @click="setView('home')">üî• Hot</button>
                <button :class="['secondary', { active: view === 'search' }]" @click="setView('search')">üîç Search</button>
            </div>
            <input 
                v-if="view === 'search'"
                v-model="searchQuery" 
                @input="debouncedSearch" 
                class="search-box" 
                placeholder="Search for movies or TV series..." 
                autofocus
            >
        </div>
    </header>

        <!-- Missing API Key State -->
        <div v-if="!hasApiKey" class="status-msg" style="color: var(--accent-color);">
            <h2>‚ö†Ô∏è Access Restricted</h2>
            <p>Please enter your OMDb API Key above.</p>
            <p style="font-style: italic; color: var(--text-secondary); margin-top: 20px;">
                "Remember the app that brought all the movies to your 'time'?"
            </p>
            <p style="font-size: 0.8em; color: #555;">(Type the answer in the API Key box to unlock)</p>
        </div>

        <!-- Loading State -->
        <div v-else-if="loading" class="status-msg">
            <div class="spinner"></div>
            <p>Fetching data...</p>
        </div>

        <!-- Error State -->
        <div v-else-if="error" class="status-msg" style="color: #ff6b6b;">
            {{ error }}
        </div>

        <!-- Empty State -->
        <div v-else-if="movies.length === 0 && !loading" class="status-msg">
            No results found.
        </div>

        <!-- Content Grid -->
        <div v-else class="media-grid">
            <div v-for="item in movies" :key="item.imdbID" class="card">
                <img 
                    :src="getImageUrl(item.Poster)" 
                    @error="$event.target.src='https://via.placeholder.com/300x450?text=No+Poster'" 
                    class="poster" 
                    :alt="item.Title"
                >
                <div class="card-content">
                    <h3 class="card-title">{{ item.Title }}</h3>
                    <div class="card-meta">
                        <span class="type-badge">{{ item.Type === 'series' ? 'Series' : 'Movie' }}</span>
                        <span>{{ item.Year }}</span>
                        <span v-if="item.imdbRating && item.imdbRating !== 'N/A'">‚≠ê {{ item.imdbRating }}</span>
                    </div>
                    
                    <button 
                        class="watch-btn" 
                        @click="handleWatch(item)"
                    >
                        <span>‚ñ∂ Watch Now</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Video Player Modal -->
    <div v-if="showPlayer" class="modal-overlay" @click.self="closePlayer">
        <div class="modal-content">
            <button class="close-btn" @click="closePlayer">‚úï Close</button>
            <div class="video-container">
                <iframe 
                    :src="currentStreamUrl" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            console.log("Vue Setup Initializing...");

            // Secret Obfuscation (Reversed Key)
            const _vault = "9b54bee4"; 

            // State
            const apiKey = ref(localStorage.getItem('omdb_api_key') || '');
            console.log("Initial API Key State:", !!apiKey.value);
            
            const tempApiKey = ref('');
            const movies = ref([]);
            const loading = ref(false);
            const error = ref(null);
            const searchQuery = ref('');
            const view = ref('home'); // 'home' (curated) | 'search'
            
            // Player State
            const showPlayer = ref(false);
            const currentStreamUrl = ref('');

            // Axios Setup
            const api = axios.create({
                baseURL: 'https://www.omdbapi.com/',
            });

            // Add API Key to requests
            api.interceptors.request.use(config => {
                if (apiKey.value) {
                    config.params = { ...config.params, apikey: apiKey.value };
                }
                return config;
            });

            // Curated list (IMDb IDs provided by user)
            const staticImdbIds = [
                "tt3566834", // A Minecraft Movie
                "tt12299608", // Mickey 17
                "tt31193180", // Sinners
                "tt10954718", // Dog Man
                "tt27714946", // The Monkey
                "tt14107334", // The Running Man
                "tt7181546",  // Ballerina
                "tt20969586", // Thunderbolts
                "tt11655566", // Lilo & Stitch
                "tt10676052"  // Fantastic Four
            ];

            // Computed
            const hasApiKey = computed(() => !!apiKey.value);

            // Methods
            const saveApiKey = () => {
                if (!tempApiKey.value) return;
                
                // Easter Egg: Check for secret password
                if (tempApiKey.value.toLowerCase().trim() === 'popcorn') {
                    const key = _vault.split('').reverse().join('');
                    apiKey.value = key;
                } else {
                    apiKey.value = tempApiKey.value;
                }
                
                localStorage.setItem('omdb_api_key', apiKey.value);
                fetchHomeContent();
            };

            const clearApiKey = () => {
                apiKey.value = '';
                localStorage.removeItem('omdb_api_key');
                movies.value = [];
            };

            const setView = (newView) => {
                view.value = newView;
                error.value = null;
                movies.value = [];
                if (newView === 'home') {
                    searchQuery.value = '';
                    fetchHomeContent();
                }
            };

            const getImageUrl = (posterUrl) => {
                return (posterUrl && posterUrl !== 'N/A') ? posterUrl : 'https://via.placeholder.com/300x450?text=No+Poster';
            };

            // Fetch specific curated movies (simulates 'Trending'/'Home')
            const fetchHomeContent = async () => {
                if (!apiKey.value) return;
                loading.value = true;
                error.value = null;
                movies.value = [];
                
                try {
                    console.log("Fetching home content (curated list)...");
                    const results = [];
                    
                    // OMDb doesn't support bulk fetch, so we fetch individually
                    for (const id of staticImdbIds) {
                        try {
                            // Fetch details by ID
                            const res = await api.get('', { params: { i: id } });
                            if (res.data.Response === "True") {
                                results.push(res.data);
                            } else {
                                console.warn(`Failed to load ${id}:`, res.data.Error);
                            }
                        } catch (e) {
                            console.error(`Error fetching ${id}:`, e);
                        }
                    }
                    movies.value = results;
                } catch (err) {
                    error.value = 'Failed to load content. Check your API key.';
                    console.error("Error in fetchHomeContent:", err);
                } finally {
                    loading.value = false;
                }
            };

            // Search via OMDb
            const searchMovies = async () => {
                if (!searchQuery.value.trim() || !apiKey.value) return;
                
                loading.value = true;
                error.value = null;
                try {
                    console.log(`Searching for: ${searchQuery.value}`);
                    const res = await api.get('', { 
                        params: { s: searchQuery.value } 
                    });

                    if (res.data.Response === "True") {
                        movies.value = res.data.Search;
                    } else {
                        // OMDb returns 200 OK with { Response: "False", Error: "..." } for no results
                        movies.value = [];
                        if (res.data.Error !== "Movie not found!") {
                            error.value = res.data.Error;
                        }
                    }
                } catch (err) {
                    error.value = 'Search failed. Please try again.';
                    console.error(err);
                } finally {
                    loading.value = false;
                }
            };

            // Debounce search
            const debouncedSearch = _.debounce(() => {
                if (searchQuery.value) searchMovies();
            }, 500);

            const handleWatch = (item) => {
                if (!item.imdbID) {
                    alert("Cannot watch: No IMDb ID found.");
                    return;
                }

                // Map OMDb 'Type' to Vidsrc 'type'
                // OMDb: 'movie', 'series', 'episode'
                // Vidsrc: 'movie', 'tv'
                let type = 'movie';
                if (item.Type === 'series' || item.Type === 'episode') {
                    type = 'tv';
                }

                currentStreamUrl.value = `https://vidsrc.cc/v2/embed/${type}/${item.imdbID}`;
                showPlayer.value = true;
            };

            const closePlayer = () => {
                showPlayer.value = false;
                currentStreamUrl.value = '';
            };

            // Lifecycle
            onMounted(() => {
                if (hasApiKey.value) {
                    fetchHomeContent();
                }
            });

            return {
                apiKey,
                tempApiKey,
                hasApiKey,
                saveApiKey,
                clearApiKey,
                movies,
                loading,
                error,
                searchQuery,
                debouncedSearch,
                getImageUrl,
                handleWatch,
                showPlayer,
                currentStreamUrl,
                closePlayer,
                view,
                setView
            };
        }
    }).mount('#app');
</script>

</body>
</html>