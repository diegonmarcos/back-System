version: '3.8'

# Mail Server Stack - Stalwart + Snappymail
# VM: oci-f-micro_1 (130.110.251.193)
# Updated: 2025-12-07

services:
  # Stalwart Mail Server (IMAP/SMTP)
  stalwart:
    image: stalwartlabs/mail-server:latest
    container_name: stalwart-mail
    hostname: mail.diegonmarcos.com
    restart: unless-stopped
    ports:
      - "25:25"      # SMTP (blocked by Oracle Cloud)
      - "587:587"    # SMTP Submission (STARTTLS)
      - "993:993"    # IMAPS (SSL/TLS)
      - "8080:8080"  # Admin Panel & API
    volumes:
      - stalwart_data:/opt/stalwart-mail
    networks:
      - mail_network
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "993"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Snappymail Webmail
  snappymail:
    image: djmaze/snappymail:latest
    container_name: snappymail
    restart: unless-stopped
    ports:
      - "8888:8888"
    environment:
      - SECURE_COOKIES=false
    volumes:
      - snappymail_data:/var/lib/snappymail
    networks:
      - mail_network
    depends_on:
      - stalwart

networks:
  mail_network:
    name: mail_network
    driver: bridge

volumes:
  stalwart_data:
    name: stalwart_data
  snappymail_data:
    name: snappymail_data
